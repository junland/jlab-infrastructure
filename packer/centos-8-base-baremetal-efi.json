{
   "builders":[
      {
         "accelerator": "kvm",
         "qemu_binary": "{{user `qemu_bin`}}",
         "boot_command":[
            "<up>e<wait><down><down><end><bs><bs><bs><bs><bs> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/centos-kvm-ks.cfg <leftCtrlOn>x<leftCtrlOff><wait>"
         ],
         "boot_wait": "10s",
         "disk_interface": "virtio",
         "disk_size": "{{ user `disk_size` }}",
         "format": "qcow2",
         "headless": true,
         "host_port_max": 2229,
         "host_port_min": 2222,
         "http_directory":"http/centos",
         "http_port_max": 10089,
         "http_port_min": 10082,
         "iso_checksum": "sha256:562afe0c26df9673f168d64be2dfb0d24ce981e12b81db4171820af210e4cb7d",
         "iso_url": "http://yum.tamu.edu/centos/8-stream/isos/x86_64/CentOS-Stream-8-x86_64-20210506-boot.iso",
         "net_device": "virtio-net",
         "output_directory": "centos-8-output",
         "qemuargs":[
            [
               "-m",
               "{{ user `memory` }}"
            ],
            [
               "-serial",
               "file:serial.out"
            ],
            [
               "-smp",
               "cpus={{ user `cpus` }}"
            ],
            [
               "-bios",
               "/usr/share/ovmf/OVMF.fd"
            ],
            [
               "-smbios",
               "type=0,uefi=on"
            ]
         ],
         "shutdown_command": "shutdown -P now",
         "ssh_username": "{{user `ssh_username`}}",
         "ssh_password": "{{user `ssh_password`}}",
         "ssh_port": 22,
         "ssh_timeout": "2400s",
         "type": "qemu",
         "vm_name": "centos8-base-baremetal-efi.qcow2"
      }
   ],
   "provisioners":[
      {
         "environment_vars":[
            "SSH_USERNAME={{user `ssh_username`}}",
            "SSH_PASSWORD={{user `ssh_password`}}"
         ],
         "pause_before":"10s",
         "scripts":[
            "scripts/centos/00-base.sh",
            "scripts/centos/01-baremetal.sh"
         ],
         "type":"shell"
      },
      {
         "environment_vars":[
            "SSH_USERNAME={{user `ssh_username`}}",
            "SSH_PASSWORD={{user `ssh_password`}}"
         ],
         "pause_before":"10s",
         "inline":[
            "dnf install -y git qemu-img drpm && dnf clean all -y",
            "dnf remove -y --oldinstallonly --setopt installonly_limit=2 kernel || true"
         ],
         "type":"shell"
      }
   ],
   "variables":{
      "version": "1.0.0",
      "cpus": "1",
      "memory": "1G",
      "qemu_bin": "/usr/bin/qemu-system-x86_64",
      "disk_size": "465G",
      "ssh_password": "root",
      "ssh_username": "root"
   }
}
